{"ast":null,"code":"import { toast } from \"react-toastify\";\nimport { call, put } from \"redux-saga/effects\";\nimport { logOut, saveToken } from \"utils/auth\";\nimport { requestAuthFetchMe, requestAuthLogin, requestAuthRefreshToken, requestAuthRegister } from \"./auth-requests\";\nimport { authUpdateUser } from \"./auth-slice\";\nexport default function* handleAuthRegister(action) {\n  const {\n    payload\n  } = action;\n  try {\n    const response = yield call(requestAuthRegister, payload);\n    if (response.status === 201) {\n      toast.success(\"Created new account successfully\");\n    }\n  } catch (error) {\n    console.log(error);\n  }\n}\nfunction handleAuthLogin(_ref) {\n  let {\n    payload\n  } = _ref;\n  return function* () {\n    try {\n      const response = yield call(requestAuthLogin, payload);\n      if (response.data.accessToken && response.data.refreshToken) {\n        saveToken(response.data.accessToken, response.data.refreshToken);\n        yield call(handleAuthFetchMe, {\n          payload: response.data.accessToken\n        });\n      }\n    } catch (error) {\n      const response = error.response.data;\n      if (response.statusCode === 403) {\n        toast.error(response.error.message);\n        return;\n      }\n    }\n  }();\n}\nfunction handleAuthFetchMe(_ref2) {\n  let {\n    payload\n  } = _ref2;\n  return function* () {\n    try {\n      const response = yield call(requestAuthFetchMe, payload);\n      if (response.status === 200) {\n        yield put(authUpdateUser({\n          user: response.data,\n          accessToken: payload\n        }));\n      }\n      // response.data -> userInfo\n    } catch (error) {}\n  }();\n}\nfunction handleAuthRefreshToken(_ref3) {\n  let {\n    payload\n  } = _ref3;\n  return function* () {\n    try {\n      const response = yield call(requestAuthRefreshToken, payload);\n      if (response.data) {\n        saveToken(response.data.accessToken, response.data.refreshToken);\n        yield call(handleAuthFetchMe, {\n          payload: response.data.accessToken\n        });\n      } else {\n        yield handleAuthLogOut();\n      }\n    } catch (error) {}\n  }();\n}\nfunction* handleAuthLogOut() {\n  yield put(authUpdateUser({\n    user: undefined,\n    accessToken: null\n  }));\n  logOut();\n}\nexport { handleAuthLogin, handleAuthFetchMe, handleAuthRefreshToken, handleAuthLogOut };","map":{"version":3,"names":["toast","call","put","logOut","saveToken","requestAuthFetchMe","requestAuthLogin","requestAuthRefreshToken","requestAuthRegister","authUpdateUser","handleAuthRegister","action","payload","response","status","success","error","console","log","handleAuthLogin","_ref","data","accessToken","refreshToken","handleAuthFetchMe","statusCode","message","_ref2","user","handleAuthRefreshToken","_ref3","handleAuthLogOut","undefined"],"sources":["/Users/thuyhoang/Desktop/crowfunding/src/store/auth/auth-handlers.js"],"sourcesContent":["import { toast } from \"react-toastify\";\nimport { call, put } from \"redux-saga/effects\";\nimport { logOut, saveToken } from \"utils/auth\";\nimport {\n  requestAuthFetchMe,\n  requestAuthLogin,\n  requestAuthRefreshToken,\n  requestAuthRegister,\n} from \"./auth-requests\";\nimport { authUpdateUser } from \"./auth-slice\";\n\nexport default function* handleAuthRegister(action) {\n  const { payload } = action;\n  try {\n    const response = yield call(requestAuthRegister, payload);\n    if (response.status === 201) {\n      toast.success(\"Created new account successfully\");\n    }\n  } catch (error) {\n    console.log(error);\n  }\n}\nfunction* handleAuthLogin({ payload }) {\n  try {\n    const response = yield call(requestAuthLogin, payload);\n    if (response.data.accessToken && response.data.refreshToken) {\n      saveToken(response.data.accessToken, response.data.refreshToken);\n      yield call(handleAuthFetchMe, { payload: response.data.accessToken });\n    }\n  } catch (error) {\n    const response = error.response.data;\n    if (response.statusCode === 403) {\n      toast.error(response.error.message);\n      return;\n    }\n  }\n}\n\nfunction* handleAuthFetchMe({ payload }) {\n  try {\n    const response = yield call(requestAuthFetchMe, payload);\n    if (response.status === 200) {\n      yield put(\n        authUpdateUser({\n          user: response.data,\n          accessToken: payload,\n        })\n      );\n    }\n    // response.data -> userInfo\n  } catch (error) {}\n}\n\nfunction* handleAuthRefreshToken({ payload }) {\n  try {\n    const response = yield call(requestAuthRefreshToken, payload);\n    if (response.data) {\n      saveToken(response.data.accessToken, response.data.refreshToken);\n      yield call(handleAuthFetchMe, {\n        payload: response.data.accessToken,\n      });\n    } else {\n      yield handleAuthLogOut();\n    }\n  } catch (error) {}\n}\n\nfunction* handleAuthLogOut() {\n  yield put(\n    authUpdateUser({\n      user: undefined,\n      accessToken: null,\n    })\n  );\n  logOut();\n}\n\nexport {\n  handleAuthLogin,\n  handleAuthFetchMe,\n  handleAuthRefreshToken,\n  handleAuthLogOut,\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}